import { cmykToRgb, hslToRgb, hsvToHsl, hsvToRgb, hwbToRgb, rgbToHsl } from './color-conversions';
import { CSS_COLOR_NAMES } from './color-spaces';
/** Builds a color object from Red, Green, Blue values */
export function fromRgb({ red, green, blue }, alpha = 1) {
    const coercedRed = clamp(0, 255, red);
    const coercedGreen = clamp(0, 255, green);
    const coercedBlue = clamp(0, 255, blue);
    const { hue, saturation: saturation, lightness } = rgbToHsl({
        red: coercedRed,
        green: coercedGreen,
        blue: coercedBlue,
    });
    return {
        red: coercedRed,
        green: coercedGreen,
        blue: coercedBlue,
        hue,
        saturation: saturation,
        lightness,
        alpha,
    };
}
/** Builds color object from Hue, Saturation, Lightness values */
export function fromHsl({ hue, saturation: saturation, lightness }, alpha = 1) {
    const coercedHue = clamp(0, 359, hue);
    const coercedSat = clamp(0, 100, saturation);
    const coercedLightness = clamp(0, 100, lightness);
    const { red, green, blue } = hslToRgb({ hue: coercedHue, saturation: coercedSat, lightness: coercedLightness });
    return {
        red,
        green,
        blue,
        hue: coercedHue,
        saturation: coercedSat,
        lightness: coercedLightness,
        alpha,
    };
}
/** Builds color object from Hue, Saturation, Value values */
export function fromHsv({ hue, saturation, value }, alpha = 1) {
    const coercedHue = clamp(0, 359, hue);
    const coercedSat = clamp(0, 100, saturation);
    const coercedValue = clamp(0, 100, value);
    const { red, green, blue } = hsvToRgb({ hue: coercedHue, saturation: coercedSat, value: coercedValue });
    const { hue: hslHue, saturation: hslSat, lightness: hslLightness } = hsvToHsl({
        hue: coercedHue,
        saturation: coercedSat,
        value: coercedValue,
    });
    return {
        red,
        green,
        blue,
        hue: hslHue,
        saturation: hslSat,
        lightness: hslLightness,
        alpha,
    };
}
/** Builds color object from Hue, Saturation, Value values */
export function fromHwb({ hue, whiteness, blackness }, alpha = 1) {
    const coercedHue = clamp(0, 359, hue);
    const coercedWhiteness = clamp(0, 100, whiteness);
    const coercedBlackness = clamp(0, 100, blackness);
    const rgb = hwbToRgb({ hue: coercedHue, whiteness: coercedWhiteness, blackness: coercedBlackness });
    const hsl = rgbToHsl(rgb);
    return {
        red: rgb.red,
        green: rgb.green,
        blue: rgb.blue,
        hue: coercedHue,
        saturation: hsl.saturation,
        lightness: hsl.lightness,
        alpha,
    };
}
/** Builds color object from Cyan, Magenta, Yellow and Black values */
export function fromCmyk({ cyan, magenta, yellow, black }, alpha = 1) {
    const coercedCyan = clamp(0, 100, cyan);
    const coercedMagenta = clamp(0, 100, magenta);
    const coercedYellow = clamp(0, 100, yellow);
    const coercedBlack = clamp(0, 100, black);
    const { red, green, blue } = cmykToRgb({
        cyan: coercedCyan,
        magenta: coercedMagenta,
        yellow: coercedYellow,
        black: coercedBlack,
    });
    const { hue, saturation, lightness } = rgbToHsl({ red, green, blue });
    return {
        red,
        green,
        blue,
        hue,
        saturation,
        lightness,
        alpha,
    };
}
/** Builds color object from Hex string value */
export function fromHex(hex) {
    const isValidHex = /^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(hex);
    if (!isValidHex) {
        return null;
    }
    const [red, green, blue, alpha = 100] = hex
        .replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i, (_, r, g, b, a) => '#' + r + r + g + g + b + b + a + a)
        .substring(1)
        .match(/.{2}/g)
        .map((x) => parseInt(x, 16));
    const { hue, saturation, lightness } = rgbToHsl({ red, green, blue });
    return {
        red,
        green,
        blue,
        hue,
        saturation,
        lightness,
        alpha: alpha / 100,
    };
}
export function parseString(colorString) {
    // Regex to extract values inside parenthesis
    const extractColorValuesRegex = /\((.*)\)/;
    // Transforms a string number or percentage into a valid and clamped color number
    const toColorNumber = (value, min, max, allowPercent = true) => {
        let numberValue;
        value = value.replace(' ', '');
        if (value.includes('%') && allowPercent) {
            numberValue = Number(value.replace('%', ''));
        }
        else {
            numberValue = Number(value);
            numberValue = numberValue < 1 && allowPercent ? numberValue * 100 : numberValue;
        }
        return clamp(min, max, numberValue);
    };
    colorString = colorString.toLowerCase().replace(/^\s+|\s+$/g, '');
    if (colorString.startsWith('rgb')) {
        const colorMatch = colorString.match(extractColorValuesRegex);
        if (!colorMatch) {
            return;
        }
        const colorArray = colorMatch[1].split(',');
        if (colorArray.length < 3 || colorArray.length > 4) {
            return;
        }
        const [red, green, blue, alpha = 1] = colorArray.map((x, i) => toColorNumber(x, 0, i < 3 ? 255 : 1, false));
        return fromRgb({ red, green, blue }, alpha);
    }
    if (colorString.startsWith('hsl')) {
        const colorMatch = colorString.match(extractColorValuesRegex);
        if (!colorMatch) {
            return;
        }
        const colorArray = colorMatch[1].split(',');
        if (colorArray.length < 3 || colorArray.length > 4) {
            return;
        }
        const [hueString, satString, lightnessString, alphaString = '1'] = colorArray;
        const hue = toColorNumber(hueString, 0, 359, false);
        const sat = toColorNumber(satString, 0, 100);
        const lightness = toColorNumber(lightnessString, 0, 100);
        const alpha = toColorNumber(alphaString, 0, 1);
        return fromHsl({ hue, saturation: sat, lightness }, alpha);
    }
    if (colorString.startsWith('hsv')) {
        const colorMatch = colorString.match(extractColorValuesRegex);
        if (!colorMatch) {
            return;
        }
        const colorArray = colorMatch[1].split(',');
        if (colorArray.length < 3 || colorArray.length > 4) {
            return;
        }
        const [hueString, satString, valueString, alphaString = '1'] = colorArray;
        const hue = toColorNumber(hueString, 0, 359, false);
        const sat = toColorNumber(satString, 0, 100);
        const value = toColorNumber(valueString, 0, 100);
        const alpha = toColorNumber(alphaString, 0, 1);
        return fromHsv({ hue, saturation: sat, value }, alpha);
    }
    if (colorString.startsWith('hwb')) {
        const colorMatch = colorString.match(extractColorValuesRegex);
        if (!colorMatch) {
            return;
        }
        const colorArray = colorMatch[1].split(',');
        if (colorArray.length < 3 || colorArray.length > 4) {
            return;
        }
        const [hueString, whitenessString, blacknessString, alphaString = '1'] = colorArray;
        const hue = toColorNumber(hueString, 0, 359, false);
        const whiteness = toColorNumber(whitenessString, 0, 100);
        const blackness = toColorNumber(blacknessString, 0, 100);
        const alpha = toColorNumber(alphaString, 0, 1);
        return fromHwb({ hue, whiteness, blackness }, alpha);
    }
    if (colorString.startsWith('cmyk')) {
        const colorMatch = colorString.match(extractColorValuesRegex);
        if (!colorMatch) {
            return;
        }
        const colorArray = colorMatch[1].split(',');
        if (colorArray.length < 4 || colorArray.length > 5) {
            return;
        }
        const [cyanString, magentaString, yellowString, blackString, alphaString = '1'] = colorArray;
        const cyan = toColorNumber(cyanString, 0, 100);
        const magenta = toColorNumber(magentaString, 0, 100);
        const yellow = toColorNumber(yellowString, 0, 100);
        const black = toColorNumber(blackString, 0, 100);
        const alpha = toColorNumber(alphaString, 0, 1);
        return fromCmyk({ cyan, magenta, yellow, black }, alpha);
    }
    const color = fromHex(colorString);
    if (color) {
        return color;
    }
    const cssColorName = Object.keys(CSS_COLOR_NAMES).find((c) => c.toLowerCase() === colorString.toLowerCase());
    if (cssColorName) {
        return fromHex(CSS_COLOR_NAMES[cssColorName]);
    }
    return null;
}
/**
 * Adds saturation to the color.
 * Amount is counted as a value betweeen -1 and 1, but accepts values between -100 and 100
 * @param amount The number of saturation to add
 * @param color The color to be modified
 */
export function saturate(amount, color) {
    const { hue, saturation, lightness } = color;
    const newSat = saturation + coercePercent(amount);
    return fromHsl({ hue, saturation: clamp(0, 100, newSat), lightness });
}
export function shade(amount, color) {
    amount = coercePercent(amount) * 100;
    const delta = 100 - color.lightness === 5 ? 0 : (100 - color.lightness) % 10;
    const newLightness = color.lightness + amount + delta;
    return fromHsl({ hue: color.hue, saturation: color.saturation, lightness: newLightness });
}
/** Calculates the shades of a given color from 5% to 90% of darkness */
export function calculateShades(color) {
    const colorShade = getColorShade(color);
    const shades = [];
    const amounts = [50, 100, 200, 300, 400, 500, 600, 700, 800, 900];
    let i = 0;
    while (i < amounts.length) {
        const distance = (colorShade - amounts[i]) / 10;
        const s = {
            title: `${amounts[i]}`,
            color: distance ? shade(distance, color) : color,
            active: amounts[i] === colorShade,
        };
        shades.push(s);
        i++;
    }
    return shades;
}
/**
 * Returns the complementary of a given color
 * Complementary color is calculated by spining 180deg in the color wheel
 * @param color The color to calculate it's complementary
 */
export function complementary(color) {
    return spinColor(180, color);
}
/**
 * Returns the split complementary set of a given color excluding itself
 * The split-complementary uses the two colors adjacent to its complement
 * @param color The color to calculate it's split complementary colours
 */
export function splitComplementary(color) {
    return [spinColor(60, color), spinColor(210, color)];
}
/**
 * Returns the analogous set of a given color
 * Analogous colours are calculated by spining 1/6 in each direction the color wheel
 * @param color The color to calculate it's analogous
 */
export function analogous(color) {
    return [spinColor(30, color), spinColor(-30, color)];
}
/**
 * Returns the triadic set of a given color excluding itself
 * Triadic colours are calculated by spining 1/3 color wheel
 * @param color The color to calculate it's triadic colours
 */
export function triadic(color) {
    return [spinColor(120, color), spinColor(-120, color)];
}
/**
 * Returns the tetradic set of a given color excluding itself
 * Tetradic color scheme uses four colors arranged into two complementary pairs
 * @param color The color to calculate it's tetradic colours
 */
export function tetradic(color) {
    return [spinColor(30, color), spinColor(180, color), spinColor(210, color)];
}
/**
 * Returns the square set of a given color excluding itself
 * Square colours are calculated by spining 1/4 the color wheel
 * @param color The color to calculate it's square colours
 */
export function square(color) {
    return [spinColor(90, color), spinColor(180, color), spinColor(270, color)];
}
export function spinColor(deg, color) {
    const { hue, saturation, lightness } = color;
    const rotatedHue = (hue + 360 + deg) % 360;
    return fromHsl({ hue: rotatedHue, saturation, lightness });
}
export function getColorShade(color) {
    const { lightness } = color;
    let colorShade = 100 - lightness;
    if (colorShade <= 5) {
        return 50;
    }
    if (colorShade >= 90) {
        return 900;
    }
    colorShade = Math.trunc(colorShade / 10) * 100;
    return colorShade;
}
export function clamp(min, max, value) {
    return Math.max(Math.min(value, max), min);
}
function coercePercent(amount) {
    amount = Math.max(Math.min(amount, 100), -100);
    if (amount < -1 || amount > 1) {
        return Math.trunc(amount) / 100;
    }
    return amount;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9tbmotbmd4LWNvbG9ycGlja2VyL3NyYy9saWIvY29sb3IvY29sb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEcsT0FBTyxFQUFRLGVBQWUsRUFBc0IsTUFBTSxnQkFBZ0IsQ0FBQztBQWtCM0UseURBQXlEO0FBQ3pELE1BQU0sVUFBVSxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBTyxFQUFFLFFBQWdCLENBQUM7SUFDbEUsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdEMsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDMUMsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFeEMsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxHQUFHLFFBQVEsQ0FBQztRQUMxRCxHQUFHLEVBQUUsVUFBVTtRQUNmLEtBQUssRUFBRSxZQUFZO1FBQ25CLElBQUksRUFBRSxXQUFXO0tBQ2xCLENBQUMsQ0FBQztJQUVILE9BQU87UUFDTCxHQUFHLEVBQUUsVUFBVTtRQUNmLEtBQUssRUFBRSxZQUFZO1FBQ25CLElBQUksRUFBRSxXQUFXO1FBQ2pCLEdBQUc7UUFDSCxVQUFVLEVBQUUsVUFBVTtRQUN0QixTQUFTO1FBQ1QsS0FBSztLQUNOLENBQUM7QUFDSixDQUFDO0FBRUQsaUVBQWlFO0FBQ2pFLE1BQU0sVUFBVSxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQU8sRUFBRSxRQUFnQixDQUFDO0lBQ3hGLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFFbEQsTUFBTSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7SUFFaEgsT0FBTztRQUNMLEdBQUc7UUFDSCxLQUFLO1FBQ0wsSUFBSTtRQUNKLEdBQUcsRUFBRSxVQUFVO1FBQ2YsVUFBVSxFQUFFLFVBQVU7UUFDdEIsU0FBUyxFQUFFLGdCQUFnQjtRQUMzQixLQUFLO0tBQ04sQ0FBQztBQUNKLENBQUM7QUFFRCw2REFBNkQ7QUFDN0QsTUFBTSxVQUFVLE9BQU8sQ0FBQyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFPLEVBQUUsUUFBZ0IsQ0FBQztJQUN4RSxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN0QyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUM3QyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUUxQyxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxRQUFRLENBQUMsRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDeEcsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEdBQUcsUUFBUSxDQUFDO1FBQzVFLEdBQUcsRUFBRSxVQUFVO1FBQ2YsVUFBVSxFQUFFLFVBQVU7UUFDdEIsS0FBSyxFQUFFLFlBQVk7S0FDcEIsQ0FBQyxDQUFDO0lBRUgsT0FBTztRQUNMLEdBQUc7UUFDSCxLQUFLO1FBQ0wsSUFBSTtRQUNKLEdBQUcsRUFBRSxNQUFNO1FBQ1gsVUFBVSxFQUFFLE1BQU07UUFDbEIsU0FBUyxFQUFFLFlBQVk7UUFDdkIsS0FBSztLQUNOLENBQUM7QUFDSixDQUFDO0FBRUQsNkRBQTZEO0FBQzdELE1BQU0sVUFBVSxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBTyxFQUFFLFFBQWdCLENBQUM7SUFDM0UsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdEMsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNsRCxNQUFNLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBRWxELE1BQU0sR0FBRyxHQUFHLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7SUFDcEcsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRTFCLE9BQU87UUFDTCxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUc7UUFDWixLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUs7UUFDaEIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJO1FBQ2QsR0FBRyxFQUFFLFVBQVU7UUFDZixVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVU7UUFDMUIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxTQUFTO1FBQ3hCLEtBQUs7S0FDTixDQUFDO0FBQ0osQ0FBQztBQUVELHNFQUFzRTtBQUN0RSxNQUFNLFVBQVUsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFRLEVBQUUsUUFBZ0IsQ0FBQztJQUNoRixNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN4QyxNQUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5QyxNQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM1QyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUUxQyxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxTQUFTLENBQUM7UUFDckMsSUFBSSxFQUFFLFdBQVc7UUFDakIsT0FBTyxFQUFFLGNBQWM7UUFDdkIsTUFBTSxFQUFFLGFBQWE7UUFDckIsS0FBSyxFQUFFLFlBQVk7S0FDcEIsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBRXRFLE9BQU87UUFDTCxHQUFHO1FBQ0gsS0FBSztRQUNMLElBQUk7UUFDSixHQUFHO1FBQ0gsVUFBVTtRQUNWLFNBQVM7UUFDVCxLQUFLO0tBQ04sQ0FBQztBQUNKLENBQUM7QUFFRCxnREFBZ0Q7QUFDaEQsTUFBTSxVQUFVLE9BQU8sQ0FBQyxHQUFXO0lBQ2pDLE1BQU0sVUFBVSxHQUFHLDZCQUE2QixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMzRCxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQ2YsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUVELE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRztTQUN4QyxPQUFPLENBQUMsMkNBQTJDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUM1RyxTQUFTLENBQUMsQ0FBQyxDQUFDO1NBQ1osS0FBSyxDQUFDLE9BQU8sQ0FBQztTQUNkLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRS9CLE1BQU0sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxHQUFHLFFBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUV0RSxPQUFPO1FBQ0wsR0FBRztRQUNILEtBQUs7UUFDTCxJQUFJO1FBQ0osR0FBRztRQUNILFVBQVU7UUFDVixTQUFTO1FBQ1QsS0FBSyxFQUFFLEtBQUssR0FBRyxHQUFHO0tBQ25CLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLFdBQVcsQ0FBQyxXQUFtQjtJQUM3Qyw2Q0FBNkM7SUFDN0MsTUFBTSx1QkFBdUIsR0FBRyxVQUFVLENBQUM7SUFFM0MsaUZBQWlGO0lBQ2pGLE1BQU0sYUFBYSxHQUFHLENBQUMsS0FBYSxFQUFFLEdBQVcsRUFBRSxHQUFXLEVBQUUsWUFBWSxHQUFHLElBQUksRUFBRSxFQUFFO1FBQ3JGLElBQUksV0FBbUIsQ0FBQztRQUN4QixLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFL0IsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLFlBQVksRUFBRTtZQUN2QyxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDOUM7YUFBTTtZQUNMLFdBQVcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUIsV0FBVyxHQUFHLFdBQVcsR0FBRyxDQUFDLElBQUksWUFBWSxDQUFDLENBQUMsQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7U0FDakY7UUFFRCxPQUFPLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ3RDLENBQUMsQ0FBQztJQUVGLFdBQVcsR0FBRyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNsRSxJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDakMsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixPQUFPO1NBQ1I7UUFDRCxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEQsT0FBTztTQUNSO1FBQ0QsTUFBTSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUU1RyxPQUFPLE9BQU8sQ0FBQyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDN0M7SUFDRCxJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDakMsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixPQUFPO1NBQ1I7UUFDRCxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEQsT0FBTztTQUNSO1FBRUQsTUFBTSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFdBQVcsR0FBRyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDOUUsTUFBTSxHQUFHLEdBQUcsYUFBYSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3BELE1BQU0sR0FBRyxHQUFHLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRS9DLE9BQU8sT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDNUQ7SUFDRCxJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDakMsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixPQUFPO1NBQ1I7UUFDRCxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEQsT0FBTztTQUNSO1FBQ0QsTUFBTSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFdBQVcsR0FBRyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDMUUsTUFBTSxHQUFHLEdBQUcsYUFBYSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3BELE1BQU0sR0FBRyxHQUFHLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2pELE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRS9DLE9BQU8sT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDeEQ7SUFDRCxJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDakMsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixPQUFPO1NBQ1I7UUFDRCxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEQsT0FBTztTQUNSO1FBQ0QsTUFBTSxDQUFDLFNBQVMsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLFdBQVcsR0FBRyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDcEYsTUFBTSxHQUFHLEdBQUcsYUFBYSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3BELE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRS9DLE9BQU8sT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUN0RDtJQUNELElBQUksV0FBVyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRTtRQUNsQyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLE9BQU87U0FDUjtRQUNELE1BQU0sVUFBVSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsRCxPQUFPO1NBQ1I7UUFDRCxNQUFNLENBQUMsVUFBVSxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsR0FBRyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDN0YsTUFBTSxJQUFJLEdBQUcsYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDL0MsTUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLGFBQWEsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckQsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDLFlBQVksRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDbkQsTUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDakQsTUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFL0MsT0FBTyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUMxRDtJQUVELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNuQyxJQUFJLEtBQUssRUFBRTtRQUNULE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFDRCxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxLQUFLLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO0lBQzdHLElBQUksWUFBWSxFQUFFO1FBQ2hCLE9BQU8sT0FBTyxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0tBQy9DO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsUUFBUSxDQUFDLE1BQWMsRUFBRSxLQUFZO0lBQ25ELE1BQU0sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxHQUFHLEtBQUssQ0FBQztJQUM3QyxNQUFNLE1BQU0sR0FBRyxVQUFVLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRWxELE9BQU8sT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxNQUFNLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO0FBQ3hFLENBQUM7QUFFRCxNQUFNLFVBQVUsS0FBSyxDQUFDLE1BQWMsRUFBRSxLQUFZO0lBQ2hELE1BQU0sR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBRXJDLE1BQU0sS0FBSyxHQUFHLEdBQUcsR0FBRyxLQUFLLENBQUMsU0FBUyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzdFLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxTQUFTLEdBQUcsTUFBTSxHQUFHLEtBQUssQ0FBQztJQUV0RCxPQUFPLE9BQU8sQ0FBQyxFQUFFLEdBQUcsRUFBRSxLQUFLLENBQUMsR0FBRyxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO0FBQzVGLENBQUM7QUFFRCx3RUFBd0U7QUFDeEUsTUFBTSxVQUFVLGVBQWUsQ0FBQyxLQUFZO0lBQzFDLE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QyxNQUFNLE1BQU0sR0FBNEQsRUFBRSxDQUFDO0lBRTNFLE1BQU0sT0FBTyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDbEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRVYsT0FBTyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRTtRQUN6QixNQUFNLFFBQVEsR0FBRyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDaEQsTUFBTSxDQUFDLEdBQXFEO1lBQzFELEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUN0QixLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLO1lBQ2hELE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssVUFBVTtTQUNsQyxDQUFDO1FBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNmLENBQUMsRUFBRSxDQUFDO0tBQ0w7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxhQUFhLENBQUMsS0FBWTtJQUN4QyxPQUFPLFNBQVMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDL0IsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsS0FBWTtJQUM3QyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsRUFBRSxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDdkQsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsU0FBUyxDQUFDLEtBQVk7SUFDcEMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDdkQsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsT0FBTyxDQUFDLEtBQVk7SUFDbEMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDekQsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsUUFBUSxDQUFDLEtBQVk7SUFDbkMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsU0FBUyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDOUUsQ0FBQztBQUVEOzs7O0dBSUc7QUFDSCxNQUFNLFVBQVUsTUFBTSxDQUFDLEtBQVk7SUFDakMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsU0FBUyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDOUUsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUMsR0FBVyxFQUFFLEtBQVk7SUFDakQsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLEdBQUcsS0FBSyxDQUFDO0lBQzdDLE1BQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7SUFDM0MsT0FBTyxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO0FBQzdELENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUFDLEtBQVk7SUFDeEMsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLEtBQUssQ0FBQztJQUM1QixJQUFJLFVBQVUsR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDO0lBQ2pDLElBQUksVUFBVSxJQUFJLENBQUMsRUFBRTtRQUNuQixPQUFPLEVBQUUsQ0FBQztLQUNYO0lBQ0QsSUFBSSxVQUFVLElBQUksRUFBRSxFQUFFO1FBQ3BCLE9BQU8sR0FBRyxDQUFDO0tBQ1o7SUFDRCxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQy9DLE9BQU8sVUFBVSxDQUFDO0FBQ3BCLENBQUM7QUFFRCxNQUFNLFVBQVUsS0FBSyxDQUFDLEdBQVcsRUFBRSxHQUFXLEVBQUUsS0FBYTtJQUMzRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDN0MsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLE1BQWM7SUFDbkMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQyxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQzdCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUM7S0FDakM7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY215a1RvUmdiLCBoc2xUb1JnYiwgaHN2VG9Ic2wsIGhzdlRvUmdiLCBod2JUb1JnYiwgcmdiVG9Ic2wgfSBmcm9tICcuL2NvbG9yLWNvbnZlcnNpb25zJztcbmltcG9ydCB7IENNWUssIENTU19DT0xPUl9OQU1FUywgSFNMLCBIU1YsIEhXQiwgUkdCIH0gZnJvbSAnLi9jb2xvci1zcGFjZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbG9yIHtcbiAgcmVkOiBudW1iZXI7XG4gIGdyZWVuOiBudW1iZXI7XG4gIGJsdWU6IG51bWJlcjtcbiAgaHVlOiBudW1iZXI7XG4gIHNhdHVyYXRpb246IG51bWJlcjtcbiAgbGlnaHRuZXNzOiBudW1iZXI7XG4gIGFscGhhOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFsZXR0ZUNvbG9yIHtcbiAgdGl0bGU6IHN0cmluZztcbiAgY29sb3I6IENvbG9yO1xuICBhY3RpdmU6IGJvb2xlYW47XG59XG5cbi8qKiBCdWlsZHMgYSBjb2xvciBvYmplY3QgZnJvbSBSZWQsIEdyZWVuLCBCbHVlIHZhbHVlcyAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21SZ2IoeyByZWQsIGdyZWVuLCBibHVlIH06IFJHQiwgYWxwaGE6IG51bWJlciA9IDEpOiBDb2xvciB7XG4gIGNvbnN0IGNvZXJjZWRSZWQgPSBjbGFtcCgwLCAyNTUsIHJlZCk7XG4gIGNvbnN0IGNvZXJjZWRHcmVlbiA9IGNsYW1wKDAsIDI1NSwgZ3JlZW4pO1xuICBjb25zdCBjb2VyY2VkQmx1ZSA9IGNsYW1wKDAsIDI1NSwgYmx1ZSk7XG5cbiAgY29uc3QgeyBodWUsIHNhdHVyYXRpb246IHNhdHVyYXRpb24sIGxpZ2h0bmVzcyB9ID0gcmdiVG9Ic2woe1xuICAgIHJlZDogY29lcmNlZFJlZCxcbiAgICBncmVlbjogY29lcmNlZEdyZWVuLFxuICAgIGJsdWU6IGNvZXJjZWRCbHVlLFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHJlZDogY29lcmNlZFJlZCxcbiAgICBncmVlbjogY29lcmNlZEdyZWVuLFxuICAgIGJsdWU6IGNvZXJjZWRCbHVlLFxuICAgIGh1ZSxcbiAgICBzYXR1cmF0aW9uOiBzYXR1cmF0aW9uLFxuICAgIGxpZ2h0bmVzcyxcbiAgICBhbHBoYSxcbiAgfTtcbn1cblxuLyoqIEJ1aWxkcyBjb2xvciBvYmplY3QgZnJvbSBIdWUsIFNhdHVyYXRpb24sIExpZ2h0bmVzcyB2YWx1ZXMgKi9cbmV4cG9ydCBmdW5jdGlvbiBmcm9tSHNsKHsgaHVlLCBzYXR1cmF0aW9uOiBzYXR1cmF0aW9uLCBsaWdodG5lc3MgfTogSFNMLCBhbHBoYTogbnVtYmVyID0gMSk6IENvbG9yIHtcbiAgY29uc3QgY29lcmNlZEh1ZSA9IGNsYW1wKDAsIDM1OSwgaHVlKTtcbiAgY29uc3QgY29lcmNlZFNhdCA9IGNsYW1wKDAsIDEwMCwgc2F0dXJhdGlvbik7XG4gIGNvbnN0IGNvZXJjZWRMaWdodG5lc3MgPSBjbGFtcCgwLCAxMDAsIGxpZ2h0bmVzcyk7XG5cbiAgY29uc3QgeyByZWQsIGdyZWVuLCBibHVlIH0gPSBoc2xUb1JnYih7IGh1ZTogY29lcmNlZEh1ZSwgc2F0dXJhdGlvbjogY29lcmNlZFNhdCwgbGlnaHRuZXNzOiBjb2VyY2VkTGlnaHRuZXNzIH0pO1xuXG4gIHJldHVybiB7XG4gICAgcmVkLFxuICAgIGdyZWVuLFxuICAgIGJsdWUsXG4gICAgaHVlOiBjb2VyY2VkSHVlLFxuICAgIHNhdHVyYXRpb246IGNvZXJjZWRTYXQsXG4gICAgbGlnaHRuZXNzOiBjb2VyY2VkTGlnaHRuZXNzLFxuICAgIGFscGhhLFxuICB9O1xufVxuXG4vKiogQnVpbGRzIGNvbG9yIG9iamVjdCBmcm9tIEh1ZSwgU2F0dXJhdGlvbiwgVmFsdWUgdmFsdWVzICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbUhzdih7IGh1ZSwgc2F0dXJhdGlvbiwgdmFsdWUgfTogSFNWLCBhbHBoYTogbnVtYmVyID0gMSk6IENvbG9yIHtcbiAgY29uc3QgY29lcmNlZEh1ZSA9IGNsYW1wKDAsIDM1OSwgaHVlKTtcbiAgY29uc3QgY29lcmNlZFNhdCA9IGNsYW1wKDAsIDEwMCwgc2F0dXJhdGlvbik7XG4gIGNvbnN0IGNvZXJjZWRWYWx1ZSA9IGNsYW1wKDAsIDEwMCwgdmFsdWUpO1xuXG4gIGNvbnN0IHsgcmVkLCBncmVlbiwgYmx1ZSB9ID0gaHN2VG9SZ2IoeyBodWU6IGNvZXJjZWRIdWUsIHNhdHVyYXRpb246IGNvZXJjZWRTYXQsIHZhbHVlOiBjb2VyY2VkVmFsdWUgfSk7XG4gIGNvbnN0IHsgaHVlOiBoc2xIdWUsIHNhdHVyYXRpb246IGhzbFNhdCwgbGlnaHRuZXNzOiBoc2xMaWdodG5lc3MgfSA9IGhzdlRvSHNsKHtcbiAgICBodWU6IGNvZXJjZWRIdWUsXG4gICAgc2F0dXJhdGlvbjogY29lcmNlZFNhdCxcbiAgICB2YWx1ZTogY29lcmNlZFZhbHVlLFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHJlZCxcbiAgICBncmVlbixcbiAgICBibHVlLFxuICAgIGh1ZTogaHNsSHVlLFxuICAgIHNhdHVyYXRpb246IGhzbFNhdCxcbiAgICBsaWdodG5lc3M6IGhzbExpZ2h0bmVzcyxcbiAgICBhbHBoYSxcbiAgfTtcbn1cblxuLyoqIEJ1aWxkcyBjb2xvciBvYmplY3QgZnJvbSBIdWUsIFNhdHVyYXRpb24sIFZhbHVlIHZhbHVlcyAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21Id2IoeyBodWUsIHdoaXRlbmVzcywgYmxhY2tuZXNzIH06IEhXQiwgYWxwaGE6IG51bWJlciA9IDEpOiBDb2xvciB7XG4gIGNvbnN0IGNvZXJjZWRIdWUgPSBjbGFtcCgwLCAzNTksIGh1ZSk7XG4gIGNvbnN0IGNvZXJjZWRXaGl0ZW5lc3MgPSBjbGFtcCgwLCAxMDAsIHdoaXRlbmVzcyk7XG4gIGNvbnN0IGNvZXJjZWRCbGFja25lc3MgPSBjbGFtcCgwLCAxMDAsIGJsYWNrbmVzcyk7XG5cbiAgY29uc3QgcmdiID0gaHdiVG9SZ2IoeyBodWU6IGNvZXJjZWRIdWUsIHdoaXRlbmVzczogY29lcmNlZFdoaXRlbmVzcywgYmxhY2tuZXNzOiBjb2VyY2VkQmxhY2tuZXNzIH0pO1xuICBjb25zdCBoc2wgPSByZ2JUb0hzbChyZ2IpO1xuXG4gIHJldHVybiB7XG4gICAgcmVkOiByZ2IucmVkLFxuICAgIGdyZWVuOiByZ2IuZ3JlZW4sXG4gICAgYmx1ZTogcmdiLmJsdWUsXG4gICAgaHVlOiBjb2VyY2VkSHVlLFxuICAgIHNhdHVyYXRpb246IGhzbC5zYXR1cmF0aW9uLFxuICAgIGxpZ2h0bmVzczogaHNsLmxpZ2h0bmVzcyxcbiAgICBhbHBoYSxcbiAgfTtcbn1cblxuLyoqIEJ1aWxkcyBjb2xvciBvYmplY3QgZnJvbSBDeWFuLCBNYWdlbnRhLCBZZWxsb3cgYW5kIEJsYWNrIHZhbHVlcyAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21DbXlrKHsgY3lhbiwgbWFnZW50YSwgeWVsbG93LCBibGFjayB9OiBDTVlLLCBhbHBoYTogbnVtYmVyID0gMSk6IENvbG9yIHtcbiAgY29uc3QgY29lcmNlZEN5YW4gPSBjbGFtcCgwLCAxMDAsIGN5YW4pO1xuICBjb25zdCBjb2VyY2VkTWFnZW50YSA9IGNsYW1wKDAsIDEwMCwgbWFnZW50YSk7XG4gIGNvbnN0IGNvZXJjZWRZZWxsb3cgPSBjbGFtcCgwLCAxMDAsIHllbGxvdyk7XG4gIGNvbnN0IGNvZXJjZWRCbGFjayA9IGNsYW1wKDAsIDEwMCwgYmxhY2spO1xuXG4gIGNvbnN0IHsgcmVkLCBncmVlbiwgYmx1ZSB9ID0gY215a1RvUmdiKHtcbiAgICBjeWFuOiBjb2VyY2VkQ3lhbixcbiAgICBtYWdlbnRhOiBjb2VyY2VkTWFnZW50YSxcbiAgICB5ZWxsb3c6IGNvZXJjZWRZZWxsb3csXG4gICAgYmxhY2s6IGNvZXJjZWRCbGFjayxcbiAgfSk7XG4gIGNvbnN0IHsgaHVlLCBzYXR1cmF0aW9uLCBsaWdodG5lc3MgfSA9IHJnYlRvSHNsKHsgcmVkLCBncmVlbiwgYmx1ZSB9KTtcblxuICByZXR1cm4ge1xuICAgIHJlZCxcbiAgICBncmVlbixcbiAgICBibHVlLFxuICAgIGh1ZSxcbiAgICBzYXR1cmF0aW9uLFxuICAgIGxpZ2h0bmVzcyxcbiAgICBhbHBoYSxcbiAgfTtcbn1cblxuLyoqIEJ1aWxkcyBjb2xvciBvYmplY3QgZnJvbSBIZXggc3RyaW5nIHZhbHVlICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbUhleChoZXg6IHN0cmluZyk6IENvbG9yIHtcbiAgY29uc3QgaXNWYWxpZEhleCA9IC9eIz8oW0EtRmEtZjAtOV17Myw0fSl7MSwyfSQvLnRlc3QoaGV4KTtcbiAgaWYgKCFpc1ZhbGlkSGV4KSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBbcmVkLCBncmVlbiwgYmx1ZSwgYWxwaGEgPSAxMDBdID0gaGV4XG4gICAgLnJlcGxhY2UoL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKShbYS1mXFxkXSkkL2ksIChfLCByLCBnLCBiLCBhKSA9PiAnIycgKyByICsgciArIGcgKyBnICsgYiArIGIgKyBhICsgYSlcbiAgICAuc3Vic3RyaW5nKDEpXG4gICAgLm1hdGNoKC8uezJ9L2cpXG4gICAgLm1hcCgoeCkgPT4gcGFyc2VJbnQoeCwgMTYpKTtcblxuICBjb25zdCB7IGh1ZSwgc2F0dXJhdGlvbiwgbGlnaHRuZXNzIH0gPSByZ2JUb0hzbCh7IHJlZCwgZ3JlZW4sIGJsdWUgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICByZWQsXG4gICAgZ3JlZW4sXG4gICAgYmx1ZSxcbiAgICBodWUsXG4gICAgc2F0dXJhdGlvbixcbiAgICBsaWdodG5lc3MsXG4gICAgYWxwaGE6IGFscGhhIC8gMTAwLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VTdHJpbmcoY29sb3JTdHJpbmc6IHN0cmluZyk6IENvbG9yIHwgbnVsbCB7XG4gIC8vIFJlZ2V4IHRvIGV4dHJhY3QgdmFsdWVzIGluc2lkZSBwYXJlbnRoZXNpc1xuICBjb25zdCBleHRyYWN0Q29sb3JWYWx1ZXNSZWdleCA9IC9cXCgoLiopXFwpLztcblxuICAvLyBUcmFuc2Zvcm1zIGEgc3RyaW5nIG51bWJlciBvciBwZXJjZW50YWdlIGludG8gYSB2YWxpZCBhbmQgY2xhbXBlZCBjb2xvciBudW1iZXJcbiAgY29uc3QgdG9Db2xvck51bWJlciA9ICh2YWx1ZTogc3RyaW5nLCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIsIGFsbG93UGVyY2VudCA9IHRydWUpID0+IHtcbiAgICBsZXQgbnVtYmVyVmFsdWU6IG51bWJlcjtcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJyAnLCAnJyk7XG5cbiAgICBpZiAodmFsdWUuaW5jbHVkZXMoJyUnKSAmJiBhbGxvd1BlcmNlbnQpIHtcbiAgICAgIG51bWJlclZhbHVlID0gTnVtYmVyKHZhbHVlLnJlcGxhY2UoJyUnLCAnJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBudW1iZXJWYWx1ZSA9IE51bWJlcih2YWx1ZSk7XG4gICAgICBudW1iZXJWYWx1ZSA9IG51bWJlclZhbHVlIDwgMSAmJiBhbGxvd1BlcmNlbnQgPyBudW1iZXJWYWx1ZSAqIDEwMCA6IG51bWJlclZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiBjbGFtcChtaW4sIG1heCwgbnVtYmVyVmFsdWUpO1xuICB9O1xuXG4gIGNvbG9yU3RyaW5nID0gY29sb3JTdHJpbmcudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gIGlmIChjb2xvclN0cmluZy5zdGFydHNXaXRoKCdyZ2InKSkge1xuICAgIGNvbnN0IGNvbG9yTWF0Y2ggPSBjb2xvclN0cmluZy5tYXRjaChleHRyYWN0Q29sb3JWYWx1ZXNSZWdleCk7XG4gICAgaWYgKCFjb2xvck1hdGNoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNvbG9yQXJyYXkgPSBjb2xvck1hdGNoWzFdLnNwbGl0KCcsJyk7XG4gICAgaWYgKGNvbG9yQXJyYXkubGVuZ3RoIDwgMyB8fCBjb2xvckFycmF5Lmxlbmd0aCA+IDQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgW3JlZCwgZ3JlZW4sIGJsdWUsIGFscGhhID0gMV0gPSBjb2xvckFycmF5Lm1hcCgoeCwgaSkgPT4gdG9Db2xvck51bWJlcih4LCAwLCBpIDwgMyA/IDI1NSA6IDEsIGZhbHNlKSk7XG5cbiAgICByZXR1cm4gZnJvbVJnYih7IHJlZCwgZ3JlZW4sIGJsdWUgfSwgYWxwaGEpO1xuICB9XG4gIGlmIChjb2xvclN0cmluZy5zdGFydHNXaXRoKCdoc2wnKSkge1xuICAgIGNvbnN0IGNvbG9yTWF0Y2ggPSBjb2xvclN0cmluZy5tYXRjaChleHRyYWN0Q29sb3JWYWx1ZXNSZWdleCk7XG4gICAgaWYgKCFjb2xvck1hdGNoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNvbG9yQXJyYXkgPSBjb2xvck1hdGNoWzFdLnNwbGl0KCcsJyk7XG4gICAgaWYgKGNvbG9yQXJyYXkubGVuZ3RoIDwgMyB8fCBjb2xvckFycmF5Lmxlbmd0aCA+IDQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBbaHVlU3RyaW5nLCBzYXRTdHJpbmcsIGxpZ2h0bmVzc1N0cmluZywgYWxwaGFTdHJpbmcgPSAnMSddID0gY29sb3JBcnJheTtcbiAgICBjb25zdCBodWUgPSB0b0NvbG9yTnVtYmVyKGh1ZVN0cmluZywgMCwgMzU5LCBmYWxzZSk7XG4gICAgY29uc3Qgc2F0ID0gdG9Db2xvck51bWJlcihzYXRTdHJpbmcsIDAsIDEwMCk7XG4gICAgY29uc3QgbGlnaHRuZXNzID0gdG9Db2xvck51bWJlcihsaWdodG5lc3NTdHJpbmcsIDAsIDEwMCk7XG4gICAgY29uc3QgYWxwaGEgPSB0b0NvbG9yTnVtYmVyKGFscGhhU3RyaW5nLCAwLCAxKTtcblxuICAgIHJldHVybiBmcm9tSHNsKHsgaHVlLCBzYXR1cmF0aW9uOiBzYXQsIGxpZ2h0bmVzcyB9LCBhbHBoYSk7XG4gIH1cbiAgaWYgKGNvbG9yU3RyaW5nLnN0YXJ0c1dpdGgoJ2hzdicpKSB7XG4gICAgY29uc3QgY29sb3JNYXRjaCA9IGNvbG9yU3RyaW5nLm1hdGNoKGV4dHJhY3RDb2xvclZhbHVlc1JlZ2V4KTtcbiAgICBpZiAoIWNvbG9yTWF0Y2gpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29sb3JBcnJheSA9IGNvbG9yTWF0Y2hbMV0uc3BsaXQoJywnKTtcbiAgICBpZiAoY29sb3JBcnJheS5sZW5ndGggPCAzIHx8IGNvbG9yQXJyYXkubGVuZ3RoID4gNCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBbaHVlU3RyaW5nLCBzYXRTdHJpbmcsIHZhbHVlU3RyaW5nLCBhbHBoYVN0cmluZyA9ICcxJ10gPSBjb2xvckFycmF5O1xuICAgIGNvbnN0IGh1ZSA9IHRvQ29sb3JOdW1iZXIoaHVlU3RyaW5nLCAwLCAzNTksIGZhbHNlKTtcbiAgICBjb25zdCBzYXQgPSB0b0NvbG9yTnVtYmVyKHNhdFN0cmluZywgMCwgMTAwKTtcbiAgICBjb25zdCB2YWx1ZSA9IHRvQ29sb3JOdW1iZXIodmFsdWVTdHJpbmcsIDAsIDEwMCk7XG4gICAgY29uc3QgYWxwaGEgPSB0b0NvbG9yTnVtYmVyKGFscGhhU3RyaW5nLCAwLCAxKTtcblxuICAgIHJldHVybiBmcm9tSHN2KHsgaHVlLCBzYXR1cmF0aW9uOiBzYXQsIHZhbHVlIH0sIGFscGhhKTtcbiAgfVxuICBpZiAoY29sb3JTdHJpbmcuc3RhcnRzV2l0aCgnaHdiJykpIHtcbiAgICBjb25zdCBjb2xvck1hdGNoID0gY29sb3JTdHJpbmcubWF0Y2goZXh0cmFjdENvbG9yVmFsdWVzUmVnZXgpO1xuICAgIGlmICghY29sb3JNYXRjaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBjb2xvckFycmF5ID0gY29sb3JNYXRjaFsxXS5zcGxpdCgnLCcpO1xuICAgIGlmIChjb2xvckFycmF5Lmxlbmd0aCA8IDMgfHwgY29sb3JBcnJheS5sZW5ndGggPiA0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IFtodWVTdHJpbmcsIHdoaXRlbmVzc1N0cmluZywgYmxhY2tuZXNzU3RyaW5nLCBhbHBoYVN0cmluZyA9ICcxJ10gPSBjb2xvckFycmF5O1xuICAgIGNvbnN0IGh1ZSA9IHRvQ29sb3JOdW1iZXIoaHVlU3RyaW5nLCAwLCAzNTksIGZhbHNlKTtcbiAgICBjb25zdCB3aGl0ZW5lc3MgPSB0b0NvbG9yTnVtYmVyKHdoaXRlbmVzc1N0cmluZywgMCwgMTAwKTtcbiAgICBjb25zdCBibGFja25lc3MgPSB0b0NvbG9yTnVtYmVyKGJsYWNrbmVzc1N0cmluZywgMCwgMTAwKTtcbiAgICBjb25zdCBhbHBoYSA9IHRvQ29sb3JOdW1iZXIoYWxwaGFTdHJpbmcsIDAsIDEpO1xuXG4gICAgcmV0dXJuIGZyb21Id2IoeyBodWUsIHdoaXRlbmVzcywgYmxhY2tuZXNzIH0sIGFscGhhKTtcbiAgfVxuICBpZiAoY29sb3JTdHJpbmcuc3RhcnRzV2l0aCgnY215aycpKSB7XG4gICAgY29uc3QgY29sb3JNYXRjaCA9IGNvbG9yU3RyaW5nLm1hdGNoKGV4dHJhY3RDb2xvclZhbHVlc1JlZ2V4KTtcbiAgICBpZiAoIWNvbG9yTWF0Y2gpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY29sb3JBcnJheSA9IGNvbG9yTWF0Y2hbMV0uc3BsaXQoJywnKTtcbiAgICBpZiAoY29sb3JBcnJheS5sZW5ndGggPCA0IHx8IGNvbG9yQXJyYXkubGVuZ3RoID4gNSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBbY3lhblN0cmluZywgbWFnZW50YVN0cmluZywgeWVsbG93U3RyaW5nLCBibGFja1N0cmluZywgYWxwaGFTdHJpbmcgPSAnMSddID0gY29sb3JBcnJheTtcbiAgICBjb25zdCBjeWFuID0gdG9Db2xvck51bWJlcihjeWFuU3RyaW5nLCAwLCAxMDApO1xuICAgIGNvbnN0IG1hZ2VudGEgPSB0b0NvbG9yTnVtYmVyKG1hZ2VudGFTdHJpbmcsIDAsIDEwMCk7XG4gICAgY29uc3QgeWVsbG93ID0gdG9Db2xvck51bWJlcih5ZWxsb3dTdHJpbmcsIDAsIDEwMCk7XG4gICAgY29uc3QgYmxhY2sgPSB0b0NvbG9yTnVtYmVyKGJsYWNrU3RyaW5nLCAwLCAxMDApO1xuICAgIGNvbnN0IGFscGhhID0gdG9Db2xvck51bWJlcihhbHBoYVN0cmluZywgMCwgMSk7XG5cbiAgICByZXR1cm4gZnJvbUNteWsoeyBjeWFuLCBtYWdlbnRhLCB5ZWxsb3csIGJsYWNrIH0sIGFscGhhKTtcbiAgfVxuXG4gIGNvbnN0IGNvbG9yID0gZnJvbUhleChjb2xvclN0cmluZyk7XG4gIGlmIChjb2xvcikge1xuICAgIHJldHVybiBjb2xvcjtcbiAgfVxuICBjb25zdCBjc3NDb2xvck5hbWUgPSBPYmplY3Qua2V5cyhDU1NfQ09MT1JfTkFNRVMpLmZpbmQoKGMpID0+IGMudG9Mb3dlckNhc2UoKSA9PT0gY29sb3JTdHJpbmcudG9Mb3dlckNhc2UoKSk7XG4gIGlmIChjc3NDb2xvck5hbWUpIHtcbiAgICByZXR1cm4gZnJvbUhleChDU1NfQ09MT1JfTkFNRVNbY3NzQ29sb3JOYW1lXSk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogQWRkcyBzYXR1cmF0aW9uIHRvIHRoZSBjb2xvci5cbiAqIEFtb3VudCBpcyBjb3VudGVkIGFzIGEgdmFsdWUgYmV0d2VlZW4gLTEgYW5kIDEsIGJ1dCBhY2NlcHRzIHZhbHVlcyBiZXR3ZWVuIC0xMDAgYW5kIDEwMFxuICogQHBhcmFtIGFtb3VudCBUaGUgbnVtYmVyIG9mIHNhdHVyYXRpb24gdG8gYWRkXG4gKiBAcGFyYW0gY29sb3IgVGhlIGNvbG9yIHRvIGJlIG1vZGlmaWVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYXR1cmF0ZShhbW91bnQ6IG51bWJlciwgY29sb3I6IENvbG9yKTogQ29sb3Ige1xuICBjb25zdCB7IGh1ZSwgc2F0dXJhdGlvbiwgbGlnaHRuZXNzIH0gPSBjb2xvcjtcbiAgY29uc3QgbmV3U2F0ID0gc2F0dXJhdGlvbiArIGNvZXJjZVBlcmNlbnQoYW1vdW50KTtcblxuICByZXR1cm4gZnJvbUhzbCh7IGh1ZSwgc2F0dXJhdGlvbjogY2xhbXAoMCwgMTAwLCBuZXdTYXQpLCBsaWdodG5lc3MgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaGFkZShhbW91bnQ6IG51bWJlciwgY29sb3I6IENvbG9yKTogQ29sb3Ige1xuICBhbW91bnQgPSBjb2VyY2VQZXJjZW50KGFtb3VudCkgKiAxMDA7XG5cbiAgY29uc3QgZGVsdGEgPSAxMDAgLSBjb2xvci5saWdodG5lc3MgPT09IDUgPyAwIDogKDEwMCAtIGNvbG9yLmxpZ2h0bmVzcykgJSAxMDtcbiAgY29uc3QgbmV3TGlnaHRuZXNzID0gY29sb3IubGlnaHRuZXNzICsgYW1vdW50ICsgZGVsdGE7XG5cbiAgcmV0dXJuIGZyb21Ic2woeyBodWU6IGNvbG9yLmh1ZSwgc2F0dXJhdGlvbjogY29sb3Iuc2F0dXJhdGlvbiwgbGlnaHRuZXNzOiBuZXdMaWdodG5lc3MgfSk7XG59XG5cbi8qKiBDYWxjdWxhdGVzIHRoZSBzaGFkZXMgb2YgYSBnaXZlbiBjb2xvciBmcm9tIDUlIHRvIDkwJSBvZiBkYXJrbmVzcyAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVNoYWRlcyhjb2xvcjogQ29sb3IpOiBBcnJheTx7IHRpdGxlOiBzdHJpbmc7IGNvbG9yOiBDb2xvcjsgYWN0aXZlOiBib29sZWFuIH0+IHtcbiAgY29uc3QgY29sb3JTaGFkZSA9IGdldENvbG9yU2hhZGUoY29sb3IpO1xuICBjb25zdCBzaGFkZXM6IEFycmF5PHsgdGl0bGU6IHN0cmluZzsgY29sb3I6IENvbG9yOyBhY3RpdmU6IGJvb2xlYW4gfT4gPSBbXTtcblxuICBjb25zdCBhbW91bnRzID0gWzUwLCAxMDAsIDIwMCwgMzAwLCA0MDAsIDUwMCwgNjAwLCA3MDAsIDgwMCwgOTAwXTtcbiAgbGV0IGkgPSAwO1xuXG4gIHdoaWxlIChpIDwgYW1vdW50cy5sZW5ndGgpIHtcbiAgICBjb25zdCBkaXN0YW5jZSA9IChjb2xvclNoYWRlIC0gYW1vdW50c1tpXSkgLyAxMDtcbiAgICBjb25zdCBzOiB7IHRpdGxlOiBzdHJpbmc7IGNvbG9yOiBDb2xvcjsgYWN0aXZlOiBib29sZWFuIH0gPSB7XG4gICAgICB0aXRsZTogYCR7YW1vdW50c1tpXX1gLFxuICAgICAgY29sb3I6IGRpc3RhbmNlID8gc2hhZGUoZGlzdGFuY2UsIGNvbG9yKSA6IGNvbG9yLFxuICAgICAgYWN0aXZlOiBhbW91bnRzW2ldID09PSBjb2xvclNoYWRlLFxuICAgIH07XG4gICAgc2hhZGVzLnB1c2gocyk7XG4gICAgaSsrO1xuICB9XG5cbiAgcmV0dXJuIHNoYWRlcztcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBjb21wbGVtZW50YXJ5IG9mIGEgZ2l2ZW4gY29sb3JcbiAqIENvbXBsZW1lbnRhcnkgY29sb3IgaXMgY2FsY3VsYXRlZCBieSBzcGluaW5nIDE4MGRlZyBpbiB0aGUgY29sb3Igd2hlZWxcbiAqIEBwYXJhbSBjb2xvciBUaGUgY29sb3IgdG8gY2FsY3VsYXRlIGl0J3MgY29tcGxlbWVudGFyeVxuICovXG5leHBvcnQgZnVuY3Rpb24gY29tcGxlbWVudGFyeShjb2xvcjogQ29sb3IpOiBDb2xvciB7XG4gIHJldHVybiBzcGluQ29sb3IoMTgwLCBjb2xvcik7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgc3BsaXQgY29tcGxlbWVudGFyeSBzZXQgb2YgYSBnaXZlbiBjb2xvciBleGNsdWRpbmcgaXRzZWxmXG4gKiBUaGUgc3BsaXQtY29tcGxlbWVudGFyeSB1c2VzIHRoZSB0d28gY29sb3JzIGFkamFjZW50IHRvIGl0cyBjb21wbGVtZW50XG4gKiBAcGFyYW0gY29sb3IgVGhlIGNvbG9yIHRvIGNhbGN1bGF0ZSBpdCdzIHNwbGl0IGNvbXBsZW1lbnRhcnkgY29sb3Vyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc3BsaXRDb21wbGVtZW50YXJ5KGNvbG9yOiBDb2xvcik6IFtDb2xvciwgQ29sb3JdIHtcbiAgcmV0dXJuIFtzcGluQ29sb3IoNjAsIGNvbG9yKSwgc3BpbkNvbG9yKDIxMCwgY29sb3IpXTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBhbmFsb2dvdXMgc2V0IG9mIGEgZ2l2ZW4gY29sb3JcbiAqIEFuYWxvZ291cyBjb2xvdXJzIGFyZSBjYWxjdWxhdGVkIGJ5IHNwaW5pbmcgMS82IGluIGVhY2ggZGlyZWN0aW9uIHRoZSBjb2xvciB3aGVlbFxuICogQHBhcmFtIGNvbG9yIFRoZSBjb2xvciB0byBjYWxjdWxhdGUgaXQncyBhbmFsb2dvdXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFuYWxvZ291cyhjb2xvcjogQ29sb3IpOiBbQ29sb3IsIENvbG9yXSB7XG4gIHJldHVybiBbc3BpbkNvbG9yKDMwLCBjb2xvciksIHNwaW5Db2xvcigtMzAsIGNvbG9yKV07XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgdHJpYWRpYyBzZXQgb2YgYSBnaXZlbiBjb2xvciBleGNsdWRpbmcgaXRzZWxmXG4gKiBUcmlhZGljIGNvbG91cnMgYXJlIGNhbGN1bGF0ZWQgYnkgc3BpbmluZyAxLzMgY29sb3Igd2hlZWxcbiAqIEBwYXJhbSBjb2xvciBUaGUgY29sb3IgdG8gY2FsY3VsYXRlIGl0J3MgdHJpYWRpYyBjb2xvdXJzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0cmlhZGljKGNvbG9yOiBDb2xvcik6IFtDb2xvciwgQ29sb3JdIHtcbiAgcmV0dXJuIFtzcGluQ29sb3IoMTIwLCBjb2xvciksIHNwaW5Db2xvcigtMTIwLCBjb2xvcildO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHRldHJhZGljIHNldCBvZiBhIGdpdmVuIGNvbG9yIGV4Y2x1ZGluZyBpdHNlbGZcbiAqIFRldHJhZGljIGNvbG9yIHNjaGVtZSB1c2VzIGZvdXIgY29sb3JzIGFycmFuZ2VkIGludG8gdHdvIGNvbXBsZW1lbnRhcnkgcGFpcnNcbiAqIEBwYXJhbSBjb2xvciBUaGUgY29sb3IgdG8gY2FsY3VsYXRlIGl0J3MgdGV0cmFkaWMgY29sb3Vyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdGV0cmFkaWMoY29sb3I6IENvbG9yKTogW0NvbG9yLCBDb2xvciwgQ29sb3JdIHtcbiAgcmV0dXJuIFtzcGluQ29sb3IoMzAsIGNvbG9yKSwgc3BpbkNvbG9yKDE4MCwgY29sb3IpLCBzcGluQ29sb3IoMjEwLCBjb2xvcildO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHNxdWFyZSBzZXQgb2YgYSBnaXZlbiBjb2xvciBleGNsdWRpbmcgaXRzZWxmXG4gKiBTcXVhcmUgY29sb3VycyBhcmUgY2FsY3VsYXRlZCBieSBzcGluaW5nIDEvNCB0aGUgY29sb3Igd2hlZWxcbiAqIEBwYXJhbSBjb2xvciBUaGUgY29sb3IgdG8gY2FsY3VsYXRlIGl0J3Mgc3F1YXJlIGNvbG91cnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNxdWFyZShjb2xvcjogQ29sb3IpOiBbQ29sb3IsIENvbG9yLCBDb2xvcl0ge1xuICByZXR1cm4gW3NwaW5Db2xvcig5MCwgY29sb3IpLCBzcGluQ29sb3IoMTgwLCBjb2xvciksIHNwaW5Db2xvcigyNzAsIGNvbG9yKV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzcGluQ29sb3IoZGVnOiBudW1iZXIsIGNvbG9yOiBDb2xvcik6IENvbG9yIHtcbiAgY29uc3QgeyBodWUsIHNhdHVyYXRpb24sIGxpZ2h0bmVzcyB9ID0gY29sb3I7XG4gIGNvbnN0IHJvdGF0ZWRIdWUgPSAoaHVlICsgMzYwICsgZGVnKSAlIDM2MDtcbiAgcmV0dXJuIGZyb21Ic2woeyBodWU6IHJvdGF0ZWRIdWUsIHNhdHVyYXRpb24sIGxpZ2h0bmVzcyB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbG9yU2hhZGUoY29sb3I6IENvbG9yKSB7XG4gIGNvbnN0IHsgbGlnaHRuZXNzIH0gPSBjb2xvcjtcbiAgbGV0IGNvbG9yU2hhZGUgPSAxMDAgLSBsaWdodG5lc3M7XG4gIGlmIChjb2xvclNoYWRlIDw9IDUpIHtcbiAgICByZXR1cm4gNTA7XG4gIH1cbiAgaWYgKGNvbG9yU2hhZGUgPj0gOTApIHtcbiAgICByZXR1cm4gOTAwO1xuICB9XG4gIGNvbG9yU2hhZGUgPSBNYXRoLnRydW5jKGNvbG9yU2hhZGUgLyAxMCkgKiAxMDA7XG4gIHJldHVybiBjb2xvclNoYWRlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xhbXAobWluOiBudW1iZXIsIG1heDogbnVtYmVyLCB2YWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKHZhbHVlLCBtYXgpLCBtaW4pO1xufVxuXG5mdW5jdGlvbiBjb2VyY2VQZXJjZW50KGFtb3VudDogbnVtYmVyKTogbnVtYmVyIHtcbiAgYW1vdW50ID0gTWF0aC5tYXgoTWF0aC5taW4oYW1vdW50LCAxMDApLCAtMTAwKTtcbiAgaWYgKGFtb3VudCA8IC0xIHx8IGFtb3VudCA+IDEpIHtcbiAgICByZXR1cm4gTWF0aC50cnVuYyhhbW91bnQpIC8gMTAwO1xuICB9XG4gIHJldHVybiBhbW91bnQ7XG59XG4iXX0=